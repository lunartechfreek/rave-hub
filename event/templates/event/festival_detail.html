{% extends "base.html" %}
{% load static %}

{% block title %}{{ festival.name }}{% endblock title %}
{% block heading %}{{ festival.name }}{% endblock heading %}

{% block body %}
{% if "placeholder" in festival.featured_image.url %}
style="background-image: url({% static 'images/default.jpg' %});"
{% else %}
style="background-image: url({{ festival.featured_image.url }});"
{% endif %}
{% endblock %}

{% block content %}

<div class="container">
    <div class="row">
        <div class="col-12 mt-4">
            <div class="col-12 d-flex justify-content-center">
                <div class="content-box fade-bg">
                    <p>Event Manager:
                        <a class="link" href="{% url 'user_profile' user_id=festival.event_manager.id %}">
                            {{ festival.event_manager.username }}
                        </a>
                    </p>
                    <p>Genres:
                        {% for genre in genres %}
                        {{ genre }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                    <p>Date: {{ festival.date }}</p>
                    <p>Time: {{ festival.time }}</p>

                    <!-- Artists collapse button -->
                    <a class="btn light-btn artist-btn" data-bs-toggle="collapse" href="#artists-{{ festival.id }}"
                        role="button" aria-expanded="false" aria-controls="artists-{{ festival.id }}">
                        Artists <i class="fa fa-arrow-down"></i>
                    </a>
                    <!-- Artists collapse content -->
                    <div class="collapse mt-2" id="artists-{{ festival.id }}">
                        <div class="card card-body artist-box">
                            <ul>
                                {% for artist in festival.artists.all %}
                                <li>{{ artist.name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <p>Website: <a class="link" href="{{ festival.website }}">{{ festival.website }}</a></p>
                    <p>Location: {{ festival.location_name }}</p>

                    <!-- Leaflet Map to select festival location -->
                    <div id="map" class="map"></div>

                    <!-- <a href="{% url 'edit_festival' festival.id %}">Edit</a> -->
                    {% if user == festival.event_manager %}
                    <a href="{% url 'edit_festival' festival.id %}" class="btn light-btn btn-margin">Edit</a>
                    <button class="btn light-btn btn-margin" type="button" data-bs-toggle="modal"
                        data-bs-target="#deleteModal">Delete</button>
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade text-dark" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to delete this festival?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <form method="post" action="{% url 'delete_festival' festival.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>




{% endblock %}


{% block js %}
<script>
    // Initialize the map
    let map = L.map('map').setView([`{{ festival.latitude }}`, `{{ festival.longitude }}`], 13);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Add a marker at the festival location
    L.marker([`{{ festival.latitude }}`, `{{ festival.longitude }}`]).addTo(map)
        .bindPopup('{{ festival.name }}')
        .openPopup();
</script>
{% endblock %}